{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2020 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OrderedBlockQueue = void 0;\nconst Long = __importStar(require(\"long\"));\nclass OrderedBlockQueue {\n  constructor(startBlock) {\n    this.queue = new Map();\n    this.nextBlockNumber = startBlock;\n  }\n  addBlock(event) {\n    const blockNumber = event.blockNumber;\n    if (!this.isNewBlockNumber(blockNumber)) {\n      return;\n    }\n    const key = this.blockNumberToKey(blockNumber);\n    this.queue.set(key, event);\n    if (!this.nextBlockNumber) {\n      this.nextBlockNumber = blockNumber;\n    }\n  }\n  getNextBlock() {\n    if (!this.nextBlockNumber) {\n      return;\n    }\n    const key = this.blockNumberToKey(this.nextBlockNumber);\n    const event = this.queue.get(key);\n    if (event) {\n      this.queue.delete(key);\n      this.nextBlockNumber = this.nextBlockNumber.add(Long.ONE);\n    }\n    return event;\n  }\n  getNextBlockNumber() {\n    return this.nextBlockNumber;\n  }\n  size() {\n    return this.queue.size;\n  }\n  isNewBlockNumber(blockNumber) {\n    return !this.nextBlockNumber || this.nextBlockNumber.lessThanOrEqual(blockNumber);\n  }\n  blockNumberToKey(blockNumber) {\n    return blockNumber.toString();\n  }\n}\nexports.OrderedBlockQueue = OrderedBlockQueue;","map":{"version":3,"names":["Long","__importStar","require","OrderedBlockQueue","constructor","startBlock","queue","Map","nextBlockNumber","addBlock","event","blockNumber","isNewBlockNumber","key","blockNumberToKey","set","getNextBlock","get","delete","add","ONE","getNextBlockNumber","size","lessThanOrEqual","toString","exports"],"sources":["../../../src/impl/event/orderedblockqueue.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,MAAAA,IAAA,GAAAC,YAAA,CAAAC,OAAA;AAEA,MAAaC,iBAAiB;EAI7BC,YAAYC,UAAiB;IAHZ,KAAAC,KAAK,GAAG,IAAIC,GAAG,EAAsB;IAIrD,IAAI,CAACC,eAAe,GAAGH,UAAU;EAClC;EAEAI,QAAQA,CAACC,KAAiB;IACzB,MAAMC,WAAW,GAAGD,KAAK,CAACC,WAAW;IACrC,IAAI,CAAC,IAAI,CAACC,gBAAgB,CAACD,WAAW,CAAC,EAAE;MACxC;;IAGD,MAAME,GAAG,GAAG,IAAI,CAACC,gBAAgB,CAACH,WAAW,CAAC;IAC9C,IAAI,CAACL,KAAK,CAACS,GAAG,CAACF,GAAG,EAAEH,KAAK,CAAC;IAC1B,IAAI,CAAC,IAAI,CAACF,eAAe,EAAE;MAC1B,IAAI,CAACA,eAAe,GAAGG,WAAW;;EAEpC;EAEAK,YAAYA,CAAA;IACX,IAAI,CAAC,IAAI,CAACR,eAAe,EAAE;MAC1B;;IAGD,MAAMK,GAAG,GAAG,IAAI,CAACC,gBAAgB,CAAC,IAAI,CAACN,eAAe,CAAC;IACvD,MAAME,KAAK,GAAG,IAAI,CAACJ,KAAK,CAACW,GAAG,CAACJ,GAAG,CAAC;IACjC,IAAIH,KAAK,EAAE;MACV,IAAI,CAACJ,KAAK,CAACY,MAAM,CAACL,GAAG,CAAC;MACtB,IAAI,CAACL,eAAe,GAAG,IAAI,CAACA,eAAe,CAACW,GAAG,CAACnB,IAAI,CAACoB,GAAG,CAAC;;IAG1D,OAAOV,KAAK;EACb;EAEAW,kBAAkBA,CAAA;IACjB,OAAO,IAAI,CAACb,eAAe;EAC5B;EAEAc,IAAIA,CAAA;IACH,OAAO,IAAI,CAAChB,KAAK,CAACgB,IAAI;EACvB;EAEQV,gBAAgBA,CAACD,WAAiB;IACzC,OAAO,CAAC,IAAI,CAACH,eAAe,IAAI,IAAI,CAACA,eAAe,CAACe,eAAe,CAACZ,WAAW,CAAC;EAClF;EAEQG,gBAAgBA,CAACH,WAAiB;IACzC,OAAOA,WAAW,CAACa,QAAQ,EAAE;EAC9B;;AAlDDC,OAAA,CAAAtB,iBAAA,GAAAA,iBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}