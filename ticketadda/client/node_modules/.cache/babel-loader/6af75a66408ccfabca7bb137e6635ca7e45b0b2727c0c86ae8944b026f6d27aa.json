{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2020 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.withTimeout = exports.getTransactionResponse = exports.asBuffer = exports.assertDefined = exports.notNullish = exports.cachedResult = exports.allSettled = exports.shuffle = void 0;\nconst fabric_protos_1 = require(\"fabric-protos\");\n/**\n * Knuth shuffle of array elements. The supplied array is directly modified.\n * @private\n * @param {array} array An array to shuffle.\n */\nfunction shuffle(array) {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n}\nexports.shuffle = shuffle;\n/**\n * Implementation of {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled|Promise.allSettled()}\n * for use in Node versions prior to 12.9.0, where this was introduced.\n * @private\n * @param {Iterable<Promise>} promises Iterable promises.\n * @returns An array of promises.\n */\nfunction allSettled(promises) {\n  const promiseArray = Array.isArray(promises) ? promises : Array.from(promises);\n  return Promise.all(promiseArray.map(settle));\n}\nexports.allSettled = allSettled;\nfunction settle(promise) {\n  return promise.then(value => {\n    return {\n      status: 'fulfilled',\n      value\n    };\n  }, reason => {\n    return {\n      status: 'rejected',\n      reason\n    };\n  });\n}\n/**\n * Wrap a function call with a cache. On first call the wrapped function is invoked to obtain a result. Subsequent\n * calls return the cached result.\n * @private\n * @param f A function whose result should be cached.\n */\nfunction cachedResult(f) {\n  let value;\n  return () => {\n    if (typeof value === 'undefined') {\n      value = f();\n    }\n    return value;\n  };\n}\nexports.cachedResult = cachedResult;\n/**\n * Typesafe check that a value is not nullish.\n * @private\n * @param value Any value, including null and undefined.\n */\nfunction notNullish(value) {\n  return value !== null && value !== undefined;\n}\nexports.notNullish = notNullish;\nfunction assertDefined(value, message) {\n  if (value == undefined) {\n    // eslint-disable-line eqeqeq\n    throw new Error(message);\n  }\n  return value;\n}\nexports.assertDefined = assertDefined;\nfunction asBuffer(bytes) {\n  if (!bytes) {\n    return Buffer.alloc(0);\n  }\n  return Buffer.from(bytes.buffer, bytes.byteOffset, bytes.byteLength); // Create a Buffer view to avoid copying\n}\n\nexports.asBuffer = asBuffer;\nfunction getTransactionResponse(proposalResponse) {\n  const responsePayload = fabric_protos_1.protos.ProposalResponsePayload.decode(proposalResponse.payload);\n  const chaincodeAction = fabric_protos_1.protos.ChaincodeAction.decode(responsePayload.extension);\n  return assertDefined(chaincodeAction.response, 'Missing chaincode action response');\n}\nexports.getTransactionResponse = getTransactionResponse;\nfunction withTimeout(promise, timeoutMillis, timeoutMessage) {\n  return new Promise((resolve, reject) => {\n    const timeout = setTimeout(() => reject(new Error(timeoutMessage)), timeoutMillis);\n    promise.then(resolve).catch(reject).finally(() => clearTimeout(timeout));\n  });\n}\nexports.withTimeout = withTimeout;","map":{"version":3,"names":["fabric_protos_1","require","shuffle","array","i","length","j","Math","floor","random","exports","allSettled","promises","promiseArray","Array","isArray","from","Promise","all","map","settle","promise","then","value","status","reason","cachedResult","f","notNullish","undefined","assertDefined","message","Error","asBuffer","bytes","Buffer","alloc","buffer","byteOffset","byteLength","getTransactionResponse","proposalResponse","responsePayload","protos","ProposalResponsePayload","decode","payload","chaincodeAction","ChaincodeAction","extension","response","withTimeout","timeoutMillis","timeoutMessage","resolve","reject","timeout","setTimeout","catch","finally","clearTimeout"],"sources":["../../src/impl/gatewayutils.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}