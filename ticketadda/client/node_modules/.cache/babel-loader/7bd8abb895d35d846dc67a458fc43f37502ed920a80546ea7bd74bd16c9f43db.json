{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2020 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.newCommitEvent = void 0;\nconst gatewayutils_1 = require(\"../gatewayutils\");\nconst filteredblockeventfactory_1 = require(\"./filteredblockeventfactory\");\nconst TransactionStatus = __importStar(require(\"./transactionstatus\"));\nconst util = __importStar(require(\"util\"));\nfunction newCommitEvent(peer, eventInfo) {\n  if (!eventInfo.transactionId || !eventInfo.status) {\n    throw new Error('Invalid event info for commit event: ' + util.inspect(eventInfo));\n  }\n  const transactionId = eventInfo.transactionId;\n  const getBlockEvent = (0, gatewayutils_1.cachedResult)(() => (0, filteredblockeventfactory_1.newFilteredBlockEvent)(eventInfo));\n  const getTransactionEvent = (0, gatewayutils_1.cachedResult)(() => {\n    const blockEvent = getBlockEvent();\n    const transactionEvent = blockEvent.getTransactionEvents().find(tx => tx.transactionId === transactionId);\n    if (!transactionEvent) {\n      throw new Error(`Transaction ${transactionId} does not exist in block: ${util.inspect(blockEvent)}`);\n    }\n    return transactionEvent;\n  });\n  const commitEvent = {\n    peer,\n    transactionId,\n    status: eventInfo.status,\n    get transactionData() {\n      return getTransactionEvent().transactionData;\n    },\n    isValid: eventInfo.status === TransactionStatus.VALID_STATUS,\n    getBlockEvent,\n    getContractEvents: () => getTransactionEvent().getContractEvents()\n  };\n  return Object.freeze(commitEvent);\n}\nexports.newCommitEvent = newCommitEvent;","map":{"version":3,"names":["gatewayutils_1","require","filteredblockeventfactory_1","TransactionStatus","__importStar","util","newCommitEvent","peer","eventInfo","transactionId","status","Error","inspect","getBlockEvent","cachedResult","newFilteredBlockEvent","getTransactionEvent","blockEvent","transactionEvent","getTransactionEvents","find","tx","commitEvent","transactionData","isValid","VALID_STATUS","getContractEvents","Object","freeze","exports"],"sources":["../../../src/impl/event/commiteventfactory.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,MAAAA,cAAA,GAAAC,OAAA;AACA,MAAAC,2BAAA,GAAAD,OAAA;AACA,MAAAE,iBAAA,GAAAC,YAAA,CAAAH,OAAA;AACA,MAAAI,IAAA,GAAAD,YAAA,CAAAH,OAAA;AAEA,SAAgBK,cAAcA,CAACC,IAAc,EAAEC,SAAoB;EAClE,IAAI,CAACA,SAAS,CAACC,aAAa,IAAI,CAACD,SAAS,CAACE,MAAM,EAAE;IAClD,MAAM,IAAIC,KAAK,CAAC,uCAAuC,GAAGN,IAAI,CAACO,OAAO,CAACJ,SAAS,CAAC,CAAC;;EAGnF,MAAMC,aAAa,GAAGD,SAAS,CAACC,aAAa;EAC7C,MAAMI,aAAa,GAAG,IAAAb,cAAA,CAAAc,YAAY,EAAC,MAAM,IAAAZ,2BAAA,CAAAa,qBAAqB,EAACP,SAAS,CAAC,CAAC;EAC1E,MAAMQ,mBAAmB,GAAG,IAAAhB,cAAA,CAAAc,YAAY,EAAC,MAAK;IAC7C,MAAMG,UAAU,GAAGJ,aAAa,EAAE;IAClC,MAAMK,gBAAgB,GAAGD,UAAU,CAACE,oBAAoB,EAAE,CAACC,IAAI,CAAEC,EAAE,IAAKA,EAAE,CAACZ,aAAa,KAAKA,aAAa,CAAC;IAC3G,IAAI,CAACS,gBAAgB,EAAE;MACtB,MAAM,IAAIP,KAAK,CAAC,eAAeF,aAAa,6BAA6BJ,IAAI,CAACO,OAAO,CAACK,UAAU,CAAC,EAAE,CAAC;;IAErG,OAAOC,gBAAgB;EACxB,CAAC,CAAC;EAEF,MAAMI,WAAW,GAAgB;IAChCf,IAAI;IACJE,aAAa;IACbC,MAAM,EAAEF,SAAS,CAACE,MAAM;IACxB,IAAIa,eAAeA,CAAA;MAClB,OAAOP,mBAAmB,EAAE,CAACO,eAAe;IAC7C,CAAC;IACDC,OAAO,EAAEhB,SAAS,CAACE,MAAM,KAAKP,iBAAiB,CAACsB,YAAY;IAC5DZ,aAAa;IACba,iBAAiB,EAAEA,CAAA,KAAMV,mBAAmB,EAAE,CAACU,iBAAiB;GAChE;EAED,OAAOC,MAAM,CAACC,MAAM,CAACN,WAAW,CAAC;AAClC;AA7BAO,OAAA,CAAAvB,cAAA,GAAAA,cAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}