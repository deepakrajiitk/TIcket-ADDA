{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2020 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MaxMessageSizeFilterFactory = exports.MaxMessageSizeFilter = void 0;\nconst filter_1 = require(\"./filter\");\nconst constants_1 = require(\"./constants\");\nclass MaxMessageSizeFilter extends filter_1.BaseFilter {\n  constructor(options, callStream) {\n    super();\n    this.options = options;\n    this.callStream = callStream;\n    this.maxSendMessageSize = constants_1.DEFAULT_MAX_SEND_MESSAGE_LENGTH;\n    this.maxReceiveMessageSize = constants_1.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;\n    if ('grpc.max_send_message_length' in options) {\n      this.maxSendMessageSize = options['grpc.max_send_message_length'];\n    }\n    if ('grpc.max_receive_message_length' in options) {\n      this.maxReceiveMessageSize = options['grpc.max_receive_message_length'];\n    }\n  }\n  async sendMessage(message) {\n    /* A configured size of -1 means that there is no limit, so skip the check\n     * entirely */\n    if (this.maxSendMessageSize === -1) {\n      return message;\n    } else {\n      const concreteMessage = await message;\n      if (concreteMessage.message.length > this.maxSendMessageSize) {\n        this.callStream.cancelWithStatus(constants_1.Status.RESOURCE_EXHAUSTED, `Sent message larger than max (${concreteMessage.message.length} vs. ${this.maxSendMessageSize})`);\n        return Promise.reject('Message too large');\n      } else {\n        return concreteMessage;\n      }\n    }\n  }\n  async receiveMessage(message) {\n    /* A configured size of -1 means that there is no limit, so skip the check\n     * entirely */\n    if (this.maxReceiveMessageSize === -1) {\n      return message;\n    } else {\n      const concreteMessage = await message;\n      if (concreteMessage.length > this.maxReceiveMessageSize) {\n        this.callStream.cancelWithStatus(constants_1.Status.RESOURCE_EXHAUSTED, `Received message larger than max (${concreteMessage.length} vs. ${this.maxReceiveMessageSize})`);\n        return Promise.reject('Message too large');\n      } else {\n        return concreteMessage;\n      }\n    }\n  }\n}\nexports.MaxMessageSizeFilter = MaxMessageSizeFilter;\nclass MaxMessageSizeFilterFactory {\n  constructor(options) {\n    this.options = options;\n  }\n  createFilter(callStream) {\n    return new MaxMessageSizeFilter(this.options, callStream);\n  }\n}\nexports.MaxMessageSizeFilterFactory = MaxMessageSizeFilterFactory;","map":{"version":3,"names":["filter_1","require","constants_1","MaxMessageSizeFilter","BaseFilter","constructor","options","callStream","maxSendMessageSize","DEFAULT_MAX_SEND_MESSAGE_LENGTH","maxReceiveMessageSize","DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH","sendMessage","message","concreteMessage","length","cancelWithStatus","Status","RESOURCE_EXHAUSTED","Promise","reject","receiveMessage","exports","MaxMessageSizeFilterFactory","createFilter"],"sources":["/home/deepakraj/Desktop/Ticket-ADDA/ticketadda/client/node_modules/@grpc/grpc-js/src/max-message-size-filter.ts"],"sourcesContent":["/*\n * Copyright 2020 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { BaseFilter, Filter, FilterFactory } from './filter';\nimport { Call, WriteObject } from './call-stream';\nimport {\n  Status,\n  DEFAULT_MAX_SEND_MESSAGE_LENGTH,\n  DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,\n} from './constants';\nimport { ChannelOptions } from './channel-options';\n\nexport class MaxMessageSizeFilter extends BaseFilter implements Filter {\n  private maxSendMessageSize: number = DEFAULT_MAX_SEND_MESSAGE_LENGTH;\n  private maxReceiveMessageSize: number = DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;\n  constructor(\n    private readonly options: ChannelOptions,\n    private readonly callStream: Call\n  ) {\n    super();\n    if ('grpc.max_send_message_length' in options) {\n      this.maxSendMessageSize = options['grpc.max_send_message_length']!;\n    }\n    if ('grpc.max_receive_message_length' in options) {\n      this.maxReceiveMessageSize = options['grpc.max_receive_message_length']!;\n    }\n  }\n\n  async sendMessage(message: Promise<WriteObject>): Promise<WriteObject> {\n    /* A configured size of -1 means that there is no limit, so skip the check\n     * entirely */\n    if (this.maxSendMessageSize === -1) {\n      return message;\n    } else {\n      const concreteMessage = await message;\n      if (concreteMessage.message.length > this.maxSendMessageSize) {\n        this.callStream.cancelWithStatus(\n          Status.RESOURCE_EXHAUSTED,\n          `Sent message larger than max (${concreteMessage.message.length} vs. ${this.maxSendMessageSize})`\n        );\n        return Promise.reject<WriteObject>('Message too large');\n      } else {\n        return concreteMessage;\n      }\n    }\n  }\n\n  async receiveMessage(message: Promise<Buffer>): Promise<Buffer> {\n    /* A configured size of -1 means that there is no limit, so skip the check\n     * entirely */\n    if (this.maxReceiveMessageSize === -1) {\n      return message;\n    } else {\n      const concreteMessage = await message;\n      if (concreteMessage.length > this.maxReceiveMessageSize) {\n        this.callStream.cancelWithStatus(\n          Status.RESOURCE_EXHAUSTED,\n          `Received message larger than max (${concreteMessage.length} vs. ${this.maxReceiveMessageSize})`\n        );\n        return Promise.reject<Buffer>('Message too large');\n      } else {\n        return concreteMessage;\n      }\n    }\n  }\n}\n\nexport class MaxMessageSizeFilterFactory\n  implements FilterFactory<MaxMessageSizeFilter> {\n  constructor(private readonly options: ChannelOptions) {}\n\n  createFilter(callStream: Call): MaxMessageSizeFilter {\n    return new MaxMessageSizeFilter(this.options, callStream);\n  }\n}\n"],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAiBA,MAAAA,QAAA,GAAAC,OAAA;AAEA,MAAAC,WAAA,GAAAD,OAAA;AAOA,MAAaE,oBAAqB,SAAQH,QAAA,CAAAI,UAAU;EAGlDC,YACmBC,OAAuB,EACvBC,UAAgB;IAEjC,KAAK,EAAE;IAHU,KAAAD,OAAO,GAAPA,OAAO;IACP,KAAAC,UAAU,GAAVA,UAAU;IAJrB,KAAAC,kBAAkB,GAAWN,WAAA,CAAAO,+BAA+B;IAC5D,KAAAC,qBAAqB,GAAWR,WAAA,CAAAS,kCAAkC;IAMxE,IAAI,8BAA8B,IAAIL,OAAO,EAAE;MAC7C,IAAI,CAACE,kBAAkB,GAAGF,OAAO,CAAC,8BAA8B,CAAE;;IAEpE,IAAI,iCAAiC,IAAIA,OAAO,EAAE;MAChD,IAAI,CAACI,qBAAqB,GAAGJ,OAAO,CAAC,iCAAiC,CAAE;;EAE5E;EAEA,MAAMM,WAAWA,CAACC,OAA6B;IAC7C;;IAEA,IAAI,IAAI,CAACL,kBAAkB,KAAK,CAAC,CAAC,EAAE;MAClC,OAAOK,OAAO;KACf,MAAM;MACL,MAAMC,eAAe,GAAG,MAAMD,OAAO;MACrC,IAAIC,eAAe,CAACD,OAAO,CAACE,MAAM,GAAG,IAAI,CAACP,kBAAkB,EAAE;QAC5D,IAAI,CAACD,UAAU,CAACS,gBAAgB,CAC9Bd,WAAA,CAAAe,MAAM,CAACC,kBAAkB,EACzB,iCAAiCJ,eAAe,CAACD,OAAO,CAACE,MAAM,QAAQ,IAAI,CAACP,kBAAkB,GAAG,CAClG;QACD,OAAOW,OAAO,CAACC,MAAM,CAAc,mBAAmB,CAAC;OACxD,MAAM;QACL,OAAON,eAAe;;;EAG5B;EAEA,MAAMO,cAAcA,CAACR,OAAwB;IAC3C;;IAEA,IAAI,IAAI,CAACH,qBAAqB,KAAK,CAAC,CAAC,EAAE;MACrC,OAAOG,OAAO;KACf,MAAM;MACL,MAAMC,eAAe,GAAG,MAAMD,OAAO;MACrC,IAAIC,eAAe,CAACC,MAAM,GAAG,IAAI,CAACL,qBAAqB,EAAE;QACvD,IAAI,CAACH,UAAU,CAACS,gBAAgB,CAC9Bd,WAAA,CAAAe,MAAM,CAACC,kBAAkB,EACzB,qCAAqCJ,eAAe,CAACC,MAAM,QAAQ,IAAI,CAACL,qBAAqB,GAAG,CACjG;QACD,OAAOS,OAAO,CAACC,MAAM,CAAS,mBAAmB,CAAC;OACnD,MAAM;QACL,OAAON,eAAe;;;EAG5B;;AApDFQ,OAAA,CAAAnB,oBAAA,GAAAA,oBAAA;AAuDA,MAAaoB,2BAA2B;EAEtClB,YAA6BC,OAAuB;IAAvB,KAAAA,OAAO,GAAPA,OAAO;EAAmB;EAEvDkB,YAAYA,CAACjB,UAAgB;IAC3B,OAAO,IAAIJ,oBAAoB,CAAC,IAAI,CAACG,OAAO,EAAEC,UAAU,CAAC;EAC3D;;AANFe,OAAA,CAAAC,2BAAA,GAAAA,2BAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}