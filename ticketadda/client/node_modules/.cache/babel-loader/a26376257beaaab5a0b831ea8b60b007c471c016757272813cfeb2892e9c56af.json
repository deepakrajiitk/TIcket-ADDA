{"ast":null,"code":"/*\n * Copyright 2019 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TYPE = 'Discoverer';\nconst {\n  checkParameter,\n  getLogger\n} = require('./Utils.js');\nconst ServiceEndpoint = require('./ServiceEndpoint');\nconst fabproto6 = require('fabric-protos').services;\nconst logger = getLogger(TYPE);\n\n/**\n * The Discoverer class represents a peer's discovery service in the blockchain network\n *\n * @class\n * @extends ServiceEndpoint\n */\nclass Discoverer extends ServiceEndpoint {\n  /**\n   * Construct a Discoverer object with the name.\n   *\n   * @param {string} name - The name of this peer\n   * @param {Client} client - The client instance\n   * @param {string} [mspid] - The mspid (organization) of this peer\n   * @returns {Discoverer} The Discoverer instance.\n   */\n  constructor() {\n    let name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : checkParameter('name');\n    let client = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : checkParameter('client');\n    let mspid = arguments.length > 2 ? arguments[2] : undefined;\n    logger.debug(`${TYPE}.constructor[${name}] - start `);\n    super(name, client, mspid);\n    this.type = TYPE;\n    this.serviceClass = fabproto6.discovery.Discovery;\n  }\n\n  /**\n   * Send an discovery request to this peer.\n   *\n   *  [Proposal]{@link https://github.com/hyperledger/fabric/blob/release-1.2/protos/discovery/protocol.proto}\n   * @param signedEnvelope\n   * @param {Number} timeout - A number indicating milliseconds to wait on the\n   *  response before rejecting the promise with a timeout error. This\n   *  overrides the default timeout of the Peer instance and the global\n   *  timeout in the config settings.\n   * @returns {Promise<discovery.Response>}\n   */\n  sendDiscovery(signedEnvelope, timeout) {\n    const method = `sendDiscovery[${this.name}]`;\n    logger.debug(`${method} - start ----${this.name} ${this.endpoint.url}`);\n    return new Promise((resolve, reject) => {\n      if (!signedEnvelope) {\n        checkParameter('signedEnvelope');\n      }\n      if (this.connected === false) {\n        throw Error(`Discovery Client ${this.name} ${this.endpoint.url} is not connected`);\n      }\n      let rto = this.options.requestTimeout;\n      if (typeof timeout === 'number') {\n        rto = timeout;\n      }\n      const send_timeout = setTimeout(() => {\n        logger.error(`${method} - timed out after:${rto}`);\n        const return_error = new Error('REQUEST TIMEOUT');\n        this.getCharacteristics(return_error);\n        return reject(return_error);\n      }, rto);\n      this.service.discover(signedEnvelope, (err, response) => {\n        clearTimeout(send_timeout);\n        if (err) {\n          logger.debug(`${method} - Received discovery response from: ${this.endpoint.url} status: ${err}`);\n          if (err instanceof Error) {\n            this.getCharacteristics(err);\n            reject(err);\n          } else {\n            const return_error = new Error(err);\n            this.getCharacteristics(return_error);\n            reject(return_error);\n          }\n        } else {\n          if (response) {\n            logger.debug(`${method} - Received discovery response from peer \"${this.endpoint.url}\"`);\n            this.getCharacteristics(response);\n            resolve(response);\n          } else {\n            const return_error = new Error(`GRPC service failed to get a proper response from the peer ${this.endpoint.url}.`);\n            this.getCharacteristics(return_error);\n            logger.error(`${method} - rejecting with:${return_error}`);\n            reject(return_error);\n          }\n        }\n      });\n    });\n  }\n}\nmodule.exports = Discoverer;","map":{"version":3,"names":["TYPE","checkParameter","getLogger","require","ServiceEndpoint","fabproto6","services","logger","Discoverer","constructor","name","arguments","length","undefined","client","mspid","debug","type","serviceClass","discovery","Discovery","sendDiscovery","signedEnvelope","timeout","method","endpoint","url","Promise","resolve","reject","connected","Error","rto","options","requestTimeout","send_timeout","setTimeout","error","return_error","getCharacteristics","service","discover","err","response","clearTimeout","module","exports"],"sources":["/home/deepakraj/Desktop/Ticket-ADDA/ticketadda/client/node_modules/fabric-common/lib/Discoverer.js"],"sourcesContent":["/*\n * Copyright 2019 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TYPE = 'Discoverer';\n\nconst {checkParameter, getLogger} = require('./Utils.js');\nconst ServiceEndpoint = require('./ServiceEndpoint');\nconst fabproto6 = require('fabric-protos').services;\n\nconst logger = getLogger(TYPE);\n\n/**\n * The Discoverer class represents a peer's discovery service in the blockchain network\n *\n * @class\n * @extends ServiceEndpoint\n */\nclass Discoverer extends ServiceEndpoint {\n\n\t/**\n\t * Construct a Discoverer object with the name.\n\t *\n\t * @param {string} name - The name of this peer\n\t * @param {Client} client - The client instance\n\t * @param {string} [mspid] - The mspid (organization) of this peer\n\t * @returns {Discoverer} The Discoverer instance.\n\t */\n\tconstructor(name = checkParameter('name'), client = checkParameter('client'), mspid) {\n\t\tlogger.debug(`${TYPE}.constructor[${name}] - start `);\n\t\tsuper(name, client, mspid);\n\n\t\tthis.type = TYPE;\n\t\tthis.serviceClass = fabproto6.discovery.Discovery;\n\t}\n\n\t/**\n\t * Send an discovery request to this peer.\n\t *\n\t *  [Proposal]{@link https://github.com/hyperledger/fabric/blob/release-1.2/protos/discovery/protocol.proto}\n\t * @param signedEnvelope\n\t * @param {Number} timeout - A number indicating milliseconds to wait on the\n\t *  response before rejecting the promise with a timeout error. This\n\t *  overrides the default timeout of the Peer instance and the global\n\t *  timeout in the config settings.\n\t * @returns {Promise<discovery.Response>}\n\t */\n\tsendDiscovery(signedEnvelope, timeout) {\n\t\tconst method = `sendDiscovery[${this.name}]`;\n\t\tlogger.debug(`${method} - start ----${this.name} ${this.endpoint.url}`);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!signedEnvelope) {\n\t\t\t\tcheckParameter('signedEnvelope');\n\t\t\t}\n\t\t\tif (this.connected === false) {\n\t\t\t\tthrow Error(`Discovery Client ${this.name} ${this.endpoint.url} is not connected`);\n\t\t\t}\n\t\t\tlet rto = this.options.requestTimeout;\n\t\t\tif (typeof timeout === 'number') {\n\t\t\t\trto = timeout;\n\t\t\t}\n\n\t\t\tconst send_timeout = setTimeout(() => {\n\t\t\t\tlogger.error(`${method} - timed out after:${rto}`);\n\t\t\t\tconst return_error = new Error('REQUEST TIMEOUT');\n\t\t\t\tthis.getCharacteristics(return_error);\n\t\t\t\treturn reject(return_error);\n\t\t\t}, rto);\n\n\t\t\tthis.service.discover(signedEnvelope, (err, response) => {\n\t\t\t\tclearTimeout(send_timeout);\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.debug(`${method} - Received discovery response from: ${this.endpoint.url} status: ${err}`);\n\t\t\t\t\tif (err instanceof Error) {\n\t\t\t\t\t\tthis.getCharacteristics(err);\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst return_error = new Error(err);\n\t\t\t\t\t\tthis.getCharacteristics(return_error);\n\t\t\t\t\t\treject(return_error);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (response) {\n\t\t\t\t\t\tlogger.debug(`${method} - Received discovery response from peer \"${this.endpoint.url}\"`);\n\t\t\t\t\t\tthis.getCharacteristics(response);\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst return_error = new Error(`GRPC service failed to get a proper response from the peer ${this.endpoint.url}.`);\n\t\t\t\t\t\tthis.getCharacteristics(return_error);\n\t\t\t\t\t\tlogger.error(`${method} - rejecting with:${return_error}`);\n\t\t\t\t\t\treject(return_error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n}\n\nmodule.exports = Discoverer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}