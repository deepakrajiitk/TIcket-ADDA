{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2019 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FileSystemWalletStore = void 0;\nconst fs = __importStar(require(\"fs\"));\nconst path = __importStar(require(\"path\"));\nconst suffix = '.id';\nfunction isIdentityFile(file) {\n  return file.endsWith(suffix);\n}\nfunction toLabel(file) {\n  const endIndex = file.length - suffix.length;\n  return file.substring(0, endIndex);\n}\nclass FileSystemWalletStore {\n  constructor(directory) {\n    this.storePath = directory;\n  }\n  static async newInstance(directory) {\n    const mkdirOptions = {\n      recursive: true\n    };\n    await fs.promises.mkdir(directory, mkdirOptions);\n    return new FileSystemWalletStore(directory);\n  }\n  async remove(label) {\n    const file = this.toPath(label);\n    await fs.promises.unlink(file);\n  }\n  async get(label) {\n    const file = this.toPath(label);\n    try {\n      return await fs.promises.readFile(file);\n    } catch (error) {\n      return undefined;\n    }\n  }\n  async list() {\n    return (await fs.promises.readdir(this.storePath)).filter(isIdentityFile).map(toLabel);\n  }\n  async put(label, data) {\n    const file = this.toPath(label);\n    await fs.promises.writeFile(file, data);\n  }\n  toPath(label) {\n    return path.join(this.storePath, label + suffix);\n  }\n}\nexports.FileSystemWalletStore = FileSystemWalletStore;","map":{"version":3,"names":["fs","__importStar","require","path","suffix","isIdentityFile","file","endsWith","toLabel","endIndex","length","substring","FileSystemWalletStore","constructor","directory","storePath","newInstance","mkdirOptions","recursive","promises","mkdir","remove","label","toPath","unlink","get","readFile","error","undefined","list","readdir","filter","map","put","data","writeFile","join","exports"],"sources":["../../../src/impl/wallet/filesystemwalletstore.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,MAAAA,EAAA,GAAAC,YAAA,CAAAC,OAAA;AACA,MAAAC,IAAA,GAAAF,YAAA,CAAAC,OAAA;AAIA,MAAME,MAAM,GAAG,KAAK;AAEpB,SAASC,cAAcA,CAACC,IAAY;EACnC,OAAOA,IAAI,CAACC,QAAQ,CAACH,MAAM,CAAC;AAC7B;AAEA,SAASI,OAAOA,CAACF,IAAY;EAC5B,MAAMG,QAAQ,GAAGH,IAAI,CAACI,MAAM,GAAGN,MAAM,CAACM,MAAM;EAC5C,OAAOJ,IAAI,CAACK,SAAS,CAAC,CAAC,EAAEF,QAAQ,CAAC;AACnC;AAEA,MAAaG,qBAAqB;EAWjCC,YAAoBC,SAAiB;IACpC,IAAI,CAACC,SAAS,GAAGD,SAAS;EAC3B;EAZO,aAAaE,WAAWA,CAACF,SAAiB;IAChD,MAAMG,YAAY,GAAG;MACpBC,SAAS,EAAE;KACX;IACD,MAAMlB,EAAE,CAACmB,QAAQ,CAACC,KAAK,CAACN,SAAS,EAAEG,YAAY,CAAC;IAChD,OAAO,IAAIL,qBAAqB,CAACE,SAAS,CAAC;EAC5C;EAQO,MAAMO,MAAMA,CAACC,KAAa;IAChC,MAAMhB,IAAI,GAAG,IAAI,CAACiB,MAAM,CAACD,KAAK,CAAC;IAC/B,MAAMtB,EAAE,CAACmB,QAAQ,CAACK,MAAM,CAAClB,IAAI,CAAC;EAC/B;EAEO,MAAMmB,GAAGA,CAACH,KAAa;IAC7B,MAAMhB,IAAI,GAAG,IAAI,CAACiB,MAAM,CAACD,KAAK,CAAC;IAC/B,IAAI;MACH,OAAO,MAAMtB,EAAE,CAACmB,QAAQ,CAACO,QAAQ,CAACpB,IAAI,CAAC;KACvC,CAAC,OAAOqB,KAAK,EAAE;MACf,OAAOC,SAAS;;EAElB;EAEO,MAAMC,IAAIA,CAAA;IAChB,OAAO,CAAC,MAAM7B,EAAE,CAACmB,QAAQ,CAACW,OAAO,CAAC,IAAI,CAACf,SAAS,CAAC,EAC/CgB,MAAM,CAAC1B,cAAc,CAAC,CACtB2B,GAAG,CAACxB,OAAO,CAAC;EACf;EAEO,MAAMyB,GAAGA,CAACX,KAAa,EAAEY,IAAY;IAC3C,MAAM5B,IAAI,GAAG,IAAI,CAACiB,MAAM,CAACD,KAAK,CAAC;IAC/B,MAAMtB,EAAE,CAACmB,QAAQ,CAACgB,SAAS,CAAC7B,IAAI,EAAE4B,IAAI,CAAC;EACxC;EAEQX,MAAMA,CAACD,KAAa;IAC3B,OAAOnB,IAAI,CAACiC,IAAI,CAAC,IAAI,CAACrB,SAAS,EAAEO,KAAK,GAAGlB,MAAM,CAAC;EACjD;;AA1CDiC,OAAA,CAAAzB,qBAAA,GAAAA,qBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}