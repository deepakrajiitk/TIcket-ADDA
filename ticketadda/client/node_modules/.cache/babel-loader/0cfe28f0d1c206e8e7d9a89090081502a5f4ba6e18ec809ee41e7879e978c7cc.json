{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2018, 2019 IBM All Rights Reserved.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PREFER_MSPID_SCOPE_ROUND_ROBIN = exports.PREFER_MSPID_SCOPE_SINGLE = exports.MSPID_SCOPE_ROUND_ROBIN = exports.MSPID_SCOPE_SINGLE = void 0;\nconst singlequeryhandler_1 = require(\"./singlequeryhandler\");\nconst roundrobinqueryhandler_1 = require(\"./roundrobinqueryhandler\");\nfunction getOrganizationPeers(network) {\n  const mspId = network.getGateway().getIdentity().mspId;\n  return network.getChannel().getEndorsers(mspId);\n}\nfunction getNetworkPeers(network) {\n  return network.getChannel().getEndorsers();\n}\n/**\n * @typedef DefaultQueryHandlerStrategies\n * @memberof module:fabric-network\n * @property {module:fabric-network.QueryHandlerFactory} MSPID_SCOPE_SINGLE Query any one of the peers for the connected organization. Continue\n * to use the same event service for all queries unless it fails. If the client identity's organization has no peers, this strategy will fail.\n * @property {module:fabric-network.QueryHandlerFactory} MSPID_SCOPE_ROUND_ROBIN Query any one of the peers for the connected organization.\n * Use the next available peer for each successive query. If the client identity's organization has no peers, this strategy will fail.\n * @property {module:fabric-network.QueryHandlerFactory} PREFER_MSPID_SCOPE_SINGLE Query any one of the peers for the connected organization. If the\n * connected organization has no peers, query any one of the peers in the network. Continue to use the same event service for all queries unless it\n * fails.\n * @property {module:fabric-network.QueryHandlerFactory} PREFER_MSPID_SCOPE_ROUND_ROBIN Query any one of the peers for the connected organization. If\n * the connected organization has no peers, query any one of the peers in the network. Use the next available peer for each successive query.\n */\nconst MSPID_SCOPE_SINGLE = network => {\n  const peers = getOrganizationPeers(network);\n  return new singlequeryhandler_1.SingleQueryHandler(peers);\n};\nexports.MSPID_SCOPE_SINGLE = MSPID_SCOPE_SINGLE;\nconst MSPID_SCOPE_ROUND_ROBIN = network => {\n  const peers = getOrganizationPeers(network);\n  return new roundrobinqueryhandler_1.RoundRobinQueryHandler(peers);\n};\nexports.MSPID_SCOPE_ROUND_ROBIN = MSPID_SCOPE_ROUND_ROBIN;\nconst PREFER_MSPID_SCOPE_SINGLE = network => {\n  let peers = getOrganizationPeers(network);\n  if (peers.length === 0) {\n    peers = getNetworkPeers(network);\n  }\n  return new singlequeryhandler_1.SingleQueryHandler(peers);\n};\nexports.PREFER_MSPID_SCOPE_SINGLE = PREFER_MSPID_SCOPE_SINGLE;\nconst PREFER_MSPID_SCOPE_ROUND_ROBIN = network => {\n  let peers = getOrganizationPeers(network);\n  if (peers.length === 0) {\n    peers = getNetworkPeers(network);\n  }\n  return new roundrobinqueryhandler_1.RoundRobinQueryHandler(peers);\n};\nexports.PREFER_MSPID_SCOPE_ROUND_ROBIN = PREFER_MSPID_SCOPE_ROUND_ROBIN;","map":{"version":3,"names":["singlequeryhandler_1","require","roundrobinqueryhandler_1","getOrganizationPeers","network","mspId","getGateway","getIdentity","getChannel","getEndorsers","getNetworkPeers","MSPID_SCOPE_SINGLE","peers","SingleQueryHandler","exports","MSPID_SCOPE_ROUND_ROBIN","RoundRobinQueryHandler","PREFER_MSPID_SCOPE_SINGLE","length","PREFER_MSPID_SCOPE_ROUND_ROBIN"],"sources":["../../../src/impl/query/defaultqueryhandlerstrategies.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;AAMA,MAAAA,oBAAA,GAAAC,OAAA;AACA,MAAAC,wBAAA,GAAAD,OAAA;AAKA,SAASE,oBAAoBA,CAACC,OAAgB;EAC7C,MAAMC,KAAK,GAAGD,OAAO,CAACE,UAAU,EAAE,CAACC,WAAW,EAAE,CAACF,KAAK;EACtD,OAAOD,OAAO,CAACI,UAAU,EAAE,CAACC,YAAY,CAACJ,KAAK,CAAC;AAChD;AAEA,SAASK,eAAeA,CAACN,OAAgB;EACxC,OAAOA,OAAO,CAACI,UAAU,EAAE,CAACC,YAAY,EAAE;AAC3C;AAEA;;;;;;;;;;;;;AAcO,MAAME,kBAAkB,GAAyBP,OAAO,IAAI;EAClE,MAAMQ,KAAK,GAAGT,oBAAoB,CAACC,OAAO,CAAC;EAC3C,OAAO,IAAIJ,oBAAA,CAAAa,kBAAkB,CAACD,KAAK,CAAC;AACrC,CAAC;AAHYE,OAAA,CAAAH,kBAAkB,GAAAA,kBAAA;AAKxB,MAAMI,uBAAuB,GAAyBX,OAAO,IAAI;EACvE,MAAMQ,KAAK,GAAGT,oBAAoB,CAACC,OAAO,CAAC;EAC3C,OAAO,IAAIF,wBAAA,CAAAc,sBAAsB,CAACJ,KAAK,CAAC;AACzC,CAAC;AAHYE,OAAA,CAAAC,uBAAuB,GAAAA,uBAAA;AAK7B,MAAME,yBAAyB,GAAyBb,OAAO,IAAI;EACzE,IAAIQ,KAAK,GAAGT,oBAAoB,CAACC,OAAO,CAAC;EACzC,IAAIQ,KAAK,CAACM,MAAM,KAAK,CAAC,EAAE;IACvBN,KAAK,GAAGF,eAAe,CAACN,OAAO,CAAC;;EAEjC,OAAO,IAAIJ,oBAAA,CAAAa,kBAAkB,CAACD,KAAK,CAAC;AACrC,CAAC;AANYE,OAAA,CAAAG,yBAAyB,GAAAA,yBAAA;AAQ/B,MAAME,8BAA8B,GAAyBf,OAAO,IAAI;EAC9E,IAAIQ,KAAK,GAAGT,oBAAoB,CAACC,OAAO,CAAC;EACzC,IAAIQ,KAAK,CAACM,MAAM,KAAK,CAAC,EAAE;IACvBN,KAAK,GAAGF,eAAe,CAACN,OAAO,CAAC;;EAEjC,OAAO,IAAIF,wBAAA,CAAAc,sBAAsB,CAACJ,KAAK,CAAC;AACzC,CAAC;AANYE,OAAA,CAAAK,8BAA8B,GAAAA,8BAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}